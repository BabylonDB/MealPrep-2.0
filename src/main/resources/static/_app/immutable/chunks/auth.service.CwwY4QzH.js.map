{"version":3,"file":"auth.service.CwwY4QzH.js","sources":["../../../../../../src/auth.config.js","../../../../../../src/auth.service.js"],"sourcesContent":["const config = { \r\nauth0_domain: \"dev-fz1c2iwefvt687d6.us.auth0.com\", \r\nauth0_client_id: \"ddoSizKZJRP7d6DuDvVRhuccjYqPQpHZ\" \r\n}; \r\nexport default config; ","import { createAuth0Client } from \"@auth0/auth0-spa-js\"; // npm install @auth0/auth0-spa-js\r\nimport { user, jwt_token } from \"./store\";\r\nimport { goto } from '$app/navigation';\r\nimport axios from \"axios\";\r\nimport config from \"./auth.config\";\r\n\r\nlet auth0Client;\r\n\r\nasync function createClient() {\r\n  auth0Client = await createAuth0Client({\r\n    domain: config.auth0_domain,\r\n    clientId: config.auth0_client_id,\r\n  });\r\n}\r\n\r\n// Auth0 signup endpoint documentation: see https://auth0.com/docs/libraries/custom-signup#using-the-api\r\nfunction signup(\r\n  email,\r\n  password,\r\n  firstName = null,\r\n  lastName = null\r\n) {\r\n  var options = {\r\n    method: \"post\",\r\n    url: `https://${config.auth0_domain}/dbconnections/signup`,\r\n    data: {\r\n      client_id: config.auth0_client_id,\r\n      email: email,\r\n      password: password,\r\n      connection: \"Username-Password-Authentication\",\r\n      // you can set any of these properties as well if needed\r\n      // username: \"johndoe\", // if not provided, email will be used as username for login. if provided, username has to be validated (must not already exist)\r\n      // given_name: \"John\",\r\n      // family_name: \"Doe\",\r\n      // nickname: \"Johnny\", // if not provided, the part before the @ of the e-mail address will be used\r\n      // name: \"John Doe\",\r\n      // picture: \"http://example.org/jdoe.png\",\r\n    },\r\n  };\r\n\r\n  if (firstName && firstName.length > 0) {\r\n    options.data.given_name = firstName;\r\n  }\r\n\r\n  if (lastName && lastName.length > 0) {\r\n    options.data.family_name = lastName;\r\n  }\r\n\r\n  axios(options)\r\n    .then((response) => {\r\n      // wait 2 seconds. Explanation: The user roles are set automatically on signup,\r\n      // but we have to wait a short amount of time to make sure that the roles are\r\n      // stored in the database of auth0. Otherwise the roles may not be in the\r\n      // userinfo object on the first login.\r\n      setTimeout(() => {\r\n        login(email, password, true);\r\n      }, 2000);\r\n    })\r\n    .catch(function (error) {\r\n      alert(\"signup failed: \" + error);\r\n      console.log(error);\r\n    });\r\n}\r\n\r\nfunction login(username, password, redirectToHome = false) {\r\n  var options = {\r\n    method: \"post\",\r\n    url: `https://${config.auth0_domain}/oauth/token`,\r\n    data: {\r\n      grant_type: \"password\",\r\n      username: username,\r\n      password: password,\r\n      audience: `https://${config.auth0_domain}/api/v2/`,\r\n      scope: \"openid profile email\",\r\n      client_id: config.auth0_client_id,\r\n    },\r\n  };\r\n\r\n  axios(options)\r\n    .then((response) => {\r\n      const { id_token, access_token } = response.data;\r\n      jwt_token.set(id_token);\r\n      console.log(id_token);\r\n      getUserInfo(access_token);\r\n      if (redirectToHome) {\r\n        // go to start page after 500ms. Explanation: if we do not wait, the login form on the\r\n        // start page might still be visible because $isAuthenticated is not yet set to true.\r\n        setTimeout(() => {\r\n          goto(\"/\") \r\n        }, 500);\r\n      }\r\n    })\r\n    .catch(function (error) {\r\n      alert(\"login failed\");\r\n      console.log(error);\r\n    });\r\n}\r\n\r\nfunction getUserInfo(access_token) {\r\n  var options = {\r\n    method: \"get\",\r\n    url: `https://${config.auth0_domain}/oauth/userinfo`,\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: \"Bearer \" + access_token,\r\n    },\r\n  };\r\n\r\n  axios(options)\r\n    .then((response) => {\r\n      const userInfo = response.data;\r\n      user.set(userInfo);\r\n    })\r\n    .catch(function (error) {\r\n      alert(\"getUserInfo failed\");\r\n      console.log(error);\r\n    });\r\n}\r\n\r\nasync function logout() {\r\n  try {\r\n    await createClient();\r\n    user.set({ name: \"\" });\r\n    jwt_token.set(\"\");\r\n    await auth0Client.logout({logoutParams:{returnTo: window.location.origin}});\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n  goto(\"/\") // return to main page\r\n}\r\n\r\nconst auth = {\r\n  signup,\r\n  login,\r\n  logout,\r\n};\r\n\r\nexport default auth; \r\n"],"names":["config","auth0Client","createClient","createAuth0Client","signup","email","password","firstName","lastName","options","axios","response","login","error","username","redirectToHome","id_token","access_token","jwt_token","getUserInfo","goto","userInfo","user","logout","e","auth"],"mappings":"6LAAA,MAAMA,EAAS,CACf,aAAc,oCACd,gBAAiB,kCACjB,ECGA,IAAIC,EAEJ,eAAeC,GAAe,CAC5BD,EAAc,MAAME,EAAkB,CACpC,OAAQH,EAAO,aACf,SAAUA,EAAO,eACrB,CAAG,CACH,CAGA,SAASI,EACPC,EACAC,EACAC,EAAY,KACZC,EAAW,KACX,CACA,IAAIC,EAAU,CACZ,OAAQ,OACR,IAAK,WAAWT,EAAO,YAAY,wBACnC,KAAM,CACJ,UAAWA,EAAO,gBAClB,MAAOK,EACP,SAAUC,EACV,WAAY,kCAQb,CACL,EAEMC,GAAaA,EAAU,OAAS,IAClCE,EAAQ,KAAK,WAAaF,GAGxBC,GAAYA,EAAS,OAAS,IAChCC,EAAQ,KAAK,YAAcD,GAG7BE,EAAMD,CAAO,EACV,KAAME,GAAa,CAKlB,WAAW,IAAM,CACfC,EAAMP,EAAOC,EAAU,EAAI,CAC5B,EAAE,GAAI,CACb,CAAK,EACA,MAAM,SAAUO,EAAO,CACtB,MAAM,kBAAoBA,CAAK,EAC/B,QAAQ,IAAIA,CAAK,CACvB,CAAK,CACL,CAEA,SAASD,EAAME,EAAUR,EAAUS,EAAiB,GAAO,CACzD,IAAIN,EAAU,CACZ,OAAQ,OACR,IAAK,WAAWT,EAAO,YAAY,eACnC,KAAM,CACJ,WAAY,WACZ,SAAUc,EACV,SAAUR,EACV,SAAU,WAAWN,EAAO,YAAY,WACxC,MAAO,uBACP,UAAWA,EAAO,eACnB,CACL,EAEEU,EAAMD,CAAO,EACV,KAAME,GAAa,CAClB,KAAM,CAAE,SAAAK,EAAU,aAAAC,GAAiBN,EAAS,KAC5CO,EAAU,IAAIF,CAAQ,EACtB,QAAQ,IAAIA,CAAQ,EACpBG,EAAYF,CAAY,EACpBF,GAGF,WAAW,IAAM,CACfK,EAAK,GAAG,CACT,EAAE,GAAG,CAEd,CAAK,EACA,MAAM,SAAUP,EAAO,CACtB,MAAM,cAAc,EACpB,QAAQ,IAAIA,CAAK,CACvB,CAAK,CACL,CAEA,SAASM,EAAYF,EAAc,CACjC,IAAIR,EAAU,CACZ,OAAQ,MACR,IAAK,WAAWT,EAAO,YAAY,kBACnC,QAAS,CACP,eAAgB,mBAChB,cAAe,UAAYiB,CAC5B,CACL,EAEEP,EAAMD,CAAO,EACV,KAAME,GAAa,CAClB,MAAMU,EAAWV,EAAS,KAC1BW,EAAK,IAAID,CAAQ,CACvB,CAAK,EACA,MAAM,SAAUR,EAAO,CACtB,MAAM,oBAAoB,EAC1B,QAAQ,IAAIA,CAAK,CACvB,CAAK,CACL,CAEA,eAAeU,GAAS,CACtB,GAAI,CACF,MAAMrB,EAAY,EAClBoB,EAAK,IAAI,CAAE,KAAM,EAAI,CAAA,EACrBJ,EAAU,IAAI,EAAE,EAChB,MAAMjB,EAAY,OAAO,CAAC,aAAa,CAAC,SAAU,OAAO,SAAS,MAAM,CAAC,CAAC,CAC3E,OAAQuB,EAAG,CACV,QAAQ,MAAMA,CAAC,CAChB,CACDJ,EAAK,GAAG,CACV,CAEK,MAACK,EAAO,CACX,OAAArB,EACA,MAAAQ,EACA,OAAAW,CACF"}